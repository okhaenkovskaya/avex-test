(()=>{"use strict";function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function e(t,n){return(e=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,n)}function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e){return!e||"object"!==n(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function r(t){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function o(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function s(t,n,i){return(s=o()?Reflect.construct:function(t,n,i){var r=[null];r.push.apply(r,n);var o=new(Function.bind.apply(t,r));return i&&e(o,i.prototype),o}).apply(null,arguments)}function u(t){var n="function"==typeof Map?new Map:void 0;return(u=function(t){if(null===t||(i=t,-1===Function.toString.call(i).indexOf("[native code]")))return t;var i;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(t))return n.get(t);n.set(t,o)}function o(){return s(t,arguments,r(this).constructor)}return o.prototype=Object.create(t.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),e(o,t)})(t)}function c(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,o=r(t);if(e){var s=r(this).constructor;n=Reflect.construct(o,arguments,s)}else n=o.apply(this,arguments);return i(this,n)}}var a=function(n){!function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),n&&e(t,n)}(u,n);var i,r,o,s=c(u);function u(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u),(t=s.call(this)).cachedResults={},t.input=t.querySelector('input[type="search"]'),t.predictiveSearchResults=t.querySelector("[data-predictive-search]"),t.setupEventListeners(),t}return i=u,(r=[{key:"setupEventListeners",value:function(){var t=this;this.querySelector("form.search").addEventListener("submit",this.onFormSubmit.bind(this)),this.input.addEventListener("input",function(t,e){var n,i=this;return function(){for(var r=arguments.length,o=new Array(r),s=0;s<r;s++)o[s]=arguments[s];clearTimeout(n),n=setTimeout((function(){return t.apply(i,o)}),e)}}((function(e){t.onChange(e)}),300).bind(this)),this.input.addEventListener("focus",this.onFocus.bind(this)),this.addEventListener("focusout",this.onFocusOut.bind(this)),this.addEventListener("keyup",this.onKeyup.bind(this)),this.addEventListener("keydown",this.onKeydown.bind(this))}},{key:"getQuery",value:function(){return this.input.value.trim()}},{key:"onChange",value:function(){var t=this.getQuery();t.length?this.getSearchResults(t):this.close(!0)}},{key:"onFormSubmit",value:function(t){this.getQuery().length&&!this.querySelector('[aria-selected="true"] a')||t.preventDefault()}},{key:"onFocus",value:function(){var t=this.getQuery();t.length&&("true"===this.getAttribute("results")?this.open():this.getSearchResults(t))}},{key:"onFocusOut",value:function(){var t=this;setTimeout((function(){t.contains(document.activeElement)||t.close()}))}},{key:"onKeyup",value:function(t){switch(this.getQuery().length||this.close(!0),t.preventDefault(),t.code){case"ArrowUp":this.switchOption("up");break;case"ArrowDown":this.switchOption("down");break;case"Enter":this.selectOption()}}},{key:"onKeydown",value:function(t){"ArrowUp"!==t.code&&"ArrowDown"!==t.code||t.preventDefault()}},{key:"switchOption",value:function(t){if(this.getAttribute("open")){var e="up"===t,n=this.querySelector('[aria-selected="true"]'),i=this.querySelectorAll("li"),r=this.querySelector("li");e&&!n||(this.statusElement.textContent="",!e&&n?r=n.nextElementSibling||i[0]:e&&(r=n.previousElementSibling||i[i.length-1]),r!==n&&(r.setAttribute("aria-selected",!0),n&&n.setAttribute("aria-selected",!1),this.setLiveRegionText(r.textContent),this.input.setAttribute("aria-activedescendant",r.id)))}}},{key:"selectOption",value:function(){var t=this.querySelector('[aria-selected="true"] a, [aria-selected="true"] button');t&&t.click()}},{key:"getSearchResults",value:function(t){var e=this,n=t.replace(" ","-").toLowerCase();this.setLiveRegionLoadingState(),this.cachedResults[n]?this.renderSearchResults(this.cachedResults[n]):fetch("".concat(routes.predictive_search_url,"?q=").concat(encodeURIComponent(t),"&").concat(encodeURIComponent("resources[type]"),"=product&").concat(encodeURIComponent("resources[limit]"),"=4&section_id=predictive-search")).then((function(t){if(!t.ok){var n=new Error(t.status);throw e.close(),n}return t.text()})).then((function(t){var i=(new DOMParser).parseFromString(t,"text/html").querySelector("#shopify-section-predictive-search").innerHTML;e.cachedResults[n]=i,e.renderSearchResults(i)})).catch((function(t){throw e.close(),t}))}},{key:"setLiveRegionLoadingState",value:function(){this.statusElement=this.statusElement||this.querySelector(".predictive-search-status"),this.loadingText=this.loadingText||this.getAttribute("data-loading-text"),this.setLiveRegionText(this.loadingText),this.setAttribute("loading",!0)}},{key:"setLiveRegionText",value:function(t){var e=this;this.statusElement.setAttribute("aria-hidden","false"),this.statusElement.textContent=t,setTimeout((function(){e.statusElement.setAttribute("aria-hidden","true")}),1e3)}},{key:"renderSearchResults",value:function(t){this.predictiveSearchResults.innerHTML=t,this.setAttribute("results",!0),this.setLiveRegionResults(),this.open()}},{key:"setLiveRegionResults",value:function(){this.removeAttribute("loading"),this.setLiveRegionText(this.querySelector("[data-predictive-search-live-region-count-value]").textContent)}},{key:"getResultsMaxHeight",value:function(){return this.resultsMaxHeight=window.innerHeight-document.getElementById("shopify-section-header").getBoundingClientRect().bottom,this.resultsMaxHeight}},{key:"open",value:function(){this.predictiveSearchResults.style.maxHeight=this.resultsMaxHeight||"".concat(this.getResultsMaxHeight(),"px"),this.setAttribute("open",!0),this.input.setAttribute("aria-expanded",!0)}},{key:"close",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];t&&(this.input.value="",this.removeAttribute("results"));var e=this.querySelector('[aria-selected="true"]');e&&e.setAttribute("aria-selected",!1),this.input.setAttribute("aria-activedescendant",""),this.removeAttribute("open"),this.input.setAttribute("aria-expanded",!1),this.resultsMaxHeight=!1,this.predictiveSearchResults.removeAttribute("style")}}])&&t(i.prototype,r),o&&t(i,o),u}(u(HTMLElement));customElements.define("predictive-search",a)})();